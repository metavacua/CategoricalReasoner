@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix catty: <http://catty.ai/ontology#> .

# SHACL Shapes for Complete Example Validation

# Minimum Logic Count Constraint
catty:MinimumLogicCountShape
    a sh:NodeShape ;
    sh:targetNode catty:CompleteExample ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "Complete example must contain at least 6 logic instances" ;
        sh:select """
            PREFIX catty: <http://catty.ai/ontology#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            SELECT $this
            WHERE {
                {
                    SELECT (COUNT(DISTINCT ?logic) as ?logicCount)
                    WHERE {
                        ?logic rdf:type catty:Logic .
                    }
                }
                FILTER (?logicCount < 6)
            }
        """ ;
    ] .

# Minimum Morphism Count Constraint
catty:MinimumMorphismCountShape
    a sh:NodeShape ;
    sh:targetNode catty:CompleteExample ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "Complete example must contain at least 10 morphism instances" ;
        sh:select """
            PREFIX catty: <http://catty.ai/ontology#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            SELECT $this
            WHERE {
                {
                    SELECT (COUNT(DISTINCT ?morphism) as ?morphismCount)
                    WHERE {
                        ?morphism rdf:type catty:LogicMorphism .
                    }
                }
                FILTER (?morphismCount < 10)
            }
        """ ;
    ] .

# All Structural Rules Defined Constraint
catty:AllStructuralRulesShape
    a sh:NodeShape ;
    sh:targetNode catty:CompleteExample ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "Complete example must define all structural rules (Weakening, Contraction, Exchange)" ;
        sh:select """
            PREFIX catty: <http://catty.ai/ontology#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            SELECT $this
            WHERE {
                FILTER NOT EXISTS {
                    ?rule rdf:type catty:WeakeningLHS .
                }
            }
        """ ;
    ] .

# Categorical Structure Completeness
catty:CategoricalCompletenessShape
    a sh:NodeShape ;
    sh:targetNode catty:CompleteExample ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "Complete example must demonstrate complete categorical structure (objects and morphisms)" ;
        sh:select """
            PREFIX catty: <http://catty.ai/ontology#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            SELECT $this
            WHERE {
                {
                    SELECT (COUNT(DISTINCT ?object) as ?objectCount)
                    WHERE {
                        ?object rdf:type catty:Logic .
                    }
                }
                {
                    SELECT (COUNT(DISTINCT ?morphism) as ?morphismCount)
                    WHERE {
                        ?morphism rdf:type catty:LogicMorphism .
                    }
                }
                FILTER (?objectCount = 0 || ?morphismCount = 0)
            }
        """ ;
    ] .
