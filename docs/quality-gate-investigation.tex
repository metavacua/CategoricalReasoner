\section*{Quality Gate Investigation Report}

\subsection*{Scope}
Configure CTO.new quality gates for the Catty repository, including CI workflow additions and guidance for CTO.new code checks and GitHub branch protection. This report documents the investigation, choices, and assumptions made.

\subsection*{Files Examined}
\begin{itemize}
  \item \texttt{AGENTS.md} (repository-wide constraints)
  \item \texttt{CONTRIBUTING.md} (local check instructions)
  \item \texttt{.github/workflows/deploy.yml} (existing GitHub workflow)
  \item \texttt{docs/dissertation/Makefile} (LaTeX build system)
  \item \texttt{src/scripts/validate\_rdf.py} (RDF validation)
  \item \texttt{src/tests/test\_consistency.py} (SHACL validation)
  \item \texttt{src/schema/validators/validate\_rdf.py} (full RDF/SHACL validator)
  \item \texttt{src/schema/validators/validate\_tex\_structure.py} (TeX structure validator)
  \item \texttt{src/benchmarks/run.py} (SPARQL benchmark runner)
  \item \texttt{src/benchmarks/queries/*.rq} (SPARQL queries)
\end{itemize}

\subsection*{Patterns Found}
\begin{itemize}
  \item LaTeX build uses \texttt{make} under \texttt{docs/dissertation/}.
  \item TeX structure validation defaults to \texttt{thesis/chapters}, but actual content is in \texttt{docs/dissertation/chapters}.
  \item RDF/SHACL scripts assume \texttt{ontology/} or \texttt{src/ontology/} directories which do not exist in the repository.
  \item SPARQL benchmark queries target DBpedia and Wikidata, requiring non-empty results and an external network.
\end{itemize}

\subsection*{Approaches Considered}
\begin{enumerate}
  \item \textbf{Single CI workflow with all gates} (chosen).
    \begin{itemize}
      \item Ensures a single, required status check in branch protection.
      \item Enables shared dependency installation and consistent execution order.
    \end{itemize}
  \item \textbf{Separate CI jobs for build/test/benchmarks} (rejected).
    \begin{itemize}
      \item Avoids complex branch-protection configuration and redundant setup.
    \end{itemize}
  \item \textbf{Always run RDF/SHACL validation} (rejected).
    \begin{itemize}
      \item Repository lacks ontology directories; unconditional execution would block PRs.
      \item Implemented conditional checks instead.
    \end{itemize}
  \item \textbf{Benchmarks optional/skippable} (rejected).
    \begin{itemize}
      \item Repository constraints require non-empty SPARQL results.
      \item Implemented timeouts and explicit non-empty result enforcement.
    \end{itemize}
\end{enumerate}

\subsection*{Changes Implemented}
\begin{itemize}
  \item Added \texttt{.github/workflows/ci.yml} to run quality gates:
    \begin{itemize}
      \item TeX structure validation with corrected path.
      \item LaTeX build.
      \item Python syntax check.
      \item SPARQL benchmarks (DBpedia, Wikidata).
      \item Conditional RDF and SHACL validation based on directory existence.
    \end{itemize}
  \item Updated \texttt{src/benchmarks/run.py}:
    \begin{itemize}
      \item Added request timeouts for remote SPARQL queries.
      \item Enforced non-empty results for both \texttt{CONSTRUCT} and \texttt{SELECT} queries.
    \end{itemize}
\end{itemize}

\subsection*{Verification}
\begin{itemize}
  \item \texttt{docs/dissertation} LaTeX build: \textbf{failed locally} due to missing \texttt{pdflatex} in the environment.
    \begin{itemize}
      \item Command: \texttt{make clean \&\& make}
      \item Error: \texttt{make: pdflatex: No such file or directory}
    \end{itemize}
\end{itemize}

\subsection*{Assumptions}
\begin{itemize}
  \item CTO.new and GitHub branch protection are configured manually; repository changes cannot apply those settings directly.
  \item External SPARQL endpoints are available and respond within the timeout when CI runs.
  \item CI environments install LaTeX dependencies (as configured in \texttt{.github/workflows/ci.yml}).
  \item Future ontology directories will be added under \texttt{ontology/} or \texttt{src/ontology/} and will then enable the RDF/SHACL checks.
\end{itemize}

\subsection*{Decision Rationale}
The selected CI configuration balances strict quality enforcement with pragmatic handling of missing ontology directories. It aligns with repository constraints that require non-empty SPARQL results and formal LaTeX validation, while ensuring CI remains actionable for current repository contents.
